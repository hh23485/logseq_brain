- ## System design goal
	- Allow the DBMS to manage databases that exceed the amount of memory available
- ## Disk-oriented DBMS
	- Overview
		- In memory, here is a buffer pool to mapping data from the disk
			- in lecture 6
		- Disk keeps the content as well as the database files.
			- in lecture 5
		- A execution engine will insert data and query data from memory buffer pool.
			- in lecture 12-13
	- Why not use the OS
		- DBMS use `mmap` to store contents of a file into a address space of a app
		- 可行，但不好用
			- Transaction Safety
				- 操作系统中持有有脏数据，可能随时被刷回，而你可能并不希望刷回其中一部分仍然在事务中的数据
			- I/O Stalls
				- 你不知道哪些数据页已经在操作系统中了，可能你想要访问一个页，但需要操作系统不停地换出页面之后才能得到，而在此之前，你已经完全停止工作了
			- Error Handling
				- 难以验证页面数据的正确性，如果数据、页面出错，可能会得到一个 SIGBUP，DBMS 必须严格的处理所有这些错误
			- Performane Issues
				- 系统内构建的数据结构可能不是你所需的数据库的最优实现，那么可能就会成为性能瓶颈
		- TODO  to know why mmap is a bad idea from some blogs
			- Are you sure you want to use mmap in your database management system?
		- DBMS always wants to control everything
- ## File Storage
	- High performance is always to use a properietary filesystems/file format, not use general format.
	- Storage manager
		- 负责管理数据库文件
			- 跟踪谁在读写文件，读写什么位置等信息
	- Page
		- 一个固定大小的数据块
			- contains tuples, meta=data, indexes, log records
			- most system do not mix page types
				- some system require a page to be self-contained，要求能够自解释
		- 每个页面都有自己的 id
			- DBMS 会通过 id 来映射他们各自在物理上的位置
		- 在不同的层级上有不同的大小
			- 硬件上大约 4KB
				- 数据块能够被保证 failasafe 写入的最大大小
			- 操作系统大约 4KB
			- 数据库大概 512B-16KB
				- SQL Server 8KB
				- Mysql 16KB
				- SQList, DB2, Oracle 4KB
	- ### Page Storage Architecture
		- 不同的数据库系统会使用不同的文件管理方法
			- #### Heap file organization
				- unordered collection of pages, stored in random order, must support iterating over all pages
				- if only single file, it's easy to find pages.
					- ![image.png](../assets/image_1690014638198_0.png)
				- if has multi files (提升并行度，分散存储)
					- ![image.png](../assets/image_1690014735312_0.png)
					- meta-data 来跟踪哪个 page 存在什么地方，以及还有多少空闲的空间
						- ![image.png](../assets/image_1690014895802_0.png){:height 367, :width 418}
				-
				-
			- Tree file organization
			- Sequential / Sorted file Organization
			- Hashing File Organization
- Relational Databases
- Storage
- Execution
- Concurrency Control
- Recovery
- Distributed Databases
- Potpourri